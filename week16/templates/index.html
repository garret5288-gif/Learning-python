{% extends 'base.html' %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-2">
    <h3 class="mb-0">Latest posts</h3>
    <div class="d-flex align-items-center gap-2">
        <form method="get" class="d-flex" action="{{ url_for('index') }}">
            <input class="form-control form-control-sm" name="q" value="{{ q }}" placeholder="Search">
            <button class="btn btn-sm btn-outline-secondary ms-2">Search</button>
        </form>
        <a class="btn btn-sm btn-primary" href="{{ url_for('post_create') }}">New Post</a>
    </div>

</div>
<div class="list-group">
    {% for p in posts %}
    <a class="list-group-item list-group-item-action" href="{{ url_for('post_view', post_id=p.id) }}">
        <div class="d-flex justify-content-between">
            <strong>{{ p.title }}</strong>
            <small>by <a href="{{ url_for('user_profile', username=p.author.username) }}">{{ p.author.username }}</a> on
                {{ p.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
        </div>
    </a>
    {% if user and (user.id == p.author_id or user.is_admin) %}
    <form method="post" action="{{ url_for('post_delete', post_id=p.id) }}" class="mt-1">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button class="btn btn-link text-danger p-0">delete</button>
    </form>
    {% endif %}
    {% endfor %}
</div>
<nav class="mt-3">
    <ul class="pagination pagination-sm">
        <li class="page-item {% if not has_prev %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('index', q=q, page=page-1) }}">Previous</a>
        </li>
        <li class="page-item disabled"><span class="page-link">Page {{ page }}</span></li>
        <li class="page-item {% if not has_next %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('index', q=q, page=page+1) }}">Next</a>
        </li>
    </ul>
    {% if q %}
    <p class="text-muted small">Showing results for "{{ q }}"</p>
    {% endif %}
</nav>
{% endblock %}